
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-04-06
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Oryx - Running</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/readable/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="../css/bootswatch.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />


		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-docs-running-oryx project-oryx" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html">Oryx 2</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../overview.html" title="Overview">Overview</a></li>
							<li ><a href="index.html" title="Documentation">Documentation</a></li>
							<li ><a href="../contribute.html" title="Contribute">Contribute</a></li>
							<li ><a href="../download.html" title="Download">Download</a></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="http://oryxproject.github.io/oryx/" id="bannerLeft"><h1>Oryx</h1></a>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
		<div>
			<ul class="breadcrumb">
				<li class="projectVersion version-date">Version: 2.0.0-SNAPSHOT</li>
				<li class="divider">|</li>
				<li class="publishDate version-date">Last Published: 2015-04-06</li>
			</ul>
		</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar" data-spy="affix" data-offset-top="800">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#toc-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<div class="nav-collapse collapse" id="toc-nav-collapse">
						<ul id="toc" class="nav">
						<li class="toplevel"><a href="#running" title="Running">Running</a></li>
						<li class="divider-vertical"></li>
						<li class="toplevel"><a href="#trying_the_als_example" title="Trying the ALS Example">Trying the ALS Example</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<p><i>This is a temporary, manual process for distributing and running the binaries.</i></p> 
<div class="page-header">
 <h1 id="running">Running</h1>
</div> 
<p>Download the <a class="externalLink" href="https://github.com/OryxProject/oryx/releases">latest release</a> of the Oryx Batch, Speed and Serving Layer, both <tt>.jar</tt> files and <tt>.sh</tt> scripts. Alternatively, build them from source (see <a href="./Building-from-Source.html">Building-from-Source</a>).</p> 
<p>Copy binaries and scripts to machines that are part of the Hadoop cluster. They may be deployed on different machines, or on one for purposes of testing. The Speed and Batch Layers should run on at most one machine, each. The Serving Layer can run on many.</p> 
<p>Create a configuration file for your application. You may start with the example in <a href="/OryxProject/oryx/blob/master/app/conf/als-example.conf">conf/als-example.conf</a>. Modify host names, ports and directories. In particular, choose data and model directories on HDFS that exist and will be accessible to the user running Oryx binaries.</p> 
<p>Copy this config file as <tt>example.conf</tt> to the same directory as binaries and script on each machine.</p> 
<p>Run the three Layers with:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>./run.sh --layer-jar oryx-batch-2.0.0-SNAPSHOT.jar --conf example.conf
...
./run.sh --layer-jar oryx-speed-2.0.0-SNAPSHOT.jar --conf example.conf
...
./run.sh --layer-jar oryx-serving-2.0.0-SNAPSHOT.jar --conf example.conf
</pre> 
 </div> 
</div> 
<p>These need not be on the same machine, but may be (if configuration specifies different ports for the Batch and Speed Layer Spark web UI, and the Serving Layer API port). The Serving Layer may be run on several machines.</p> 
<p>Thatâ€™s all!</p> 
<h1 id="trying_the_als_example">Trying the ALS Example</h1> 
<p>If youâ€™ve used the configuration above, you are running an instance of the ALS-based recommender application.</p> 
<p>Obtain the [http://grouplens.org/datasets/movielens/](GroupLens 100k) data set and find the <tt>u.data</tt> file within. This needs to be converted to csv:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>tr '\t' ',' &lt; u.data &gt; data.csv
</pre> 
 </div> 
</div> 
<p>You may wish to monitor the content of the input and update topic while it is in action. <a href="./Cluster-Setup.html">Cluster-Setup</a> explains how to tail topics with <tt>kafka-console-consumer</tt>. The topics are named <tt>OryxInput</tt> and <tt>OryxUpdate</tt> by default.</p> 
<p>Push the input to a Serving Layer, with a local command line tool like <tt>curl</tt>:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>wget --post-file data.csv \
  --output-document - \
  --header &quot;Content-Type: text/csv&quot; \
  http://your-serving-layer:8080/ingest
</pre> 
 </div> 
</div> 
<p>If you are tailing the input topic, you should see a large amount of CSV data flow to the topic:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>196,242,3.0,881250949186
196,242,3.0,881250949
186,302,3.0,891717742
22,377,1.0,878887116
244,51,2.0,880606923
166,346,1.0,886397596
298,474,4.0,884182806
...
</pre> 
 </div> 
</div> 
<p>Soon, you should also see the Batch Layer trigger a new computation. The example configuration starts one every 5 minutes.</p> 
<p>The data is first written to HDFS. The example configuration has it written to directories under <tt>hdfs:///user/example/Oryx/data/</tt>. Within are directories named by timestamp, each containing Hadoop <tt>part-r-*</tt> files, which contain the input as <tt>SequenceFile</tt>s of <tt>Text</tt>. Although not pure text, printing them should yield some recognizable data because it is in fact text.</p> 
<div class="source"> 
 <div class="source"> 
  <pre>SEQorg.apache.hadoop.io.Textorg.apache.hadoop.io.Textï¿½ï¿½ï¿½ï¿½^ï¿½]ï¿½XØ³Nï¿½22,377,1.0,87888711662...
</pre> 
 </div> 
</div> 
<p>A model computation then begins. This should show as a number of new distributed jobs the Batch Layer. Its Spark UI is started at <tt>http://your-batch-layer:4040</tt> in the example configuration.</p> 
<p>Soon the model will complete, and it will be persisted as a combination of PMML and supporting data files in a subdirectory of <tt>hdfs:///user/example/Oryx/model/</tt>. For example, the <tt>model.pmml.gz</tt> files are compressed PMML files containing elements like:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;PMML xmlns=&quot;http://www.dmg.org/PMML-4_2&quot; version=&quot;4.2.1&quot;&gt;
    &lt;Header&gt;
        &lt;Application name=&quot;Oryx&quot;/&gt;
        &lt;Timestamp&gt;2014-12-18T04:48:54-0800&lt;/Timestamp&gt;
    &lt;/Header&gt;
    &lt;Extension name=&quot;X&quot; value=&quot;X/&quot;/&gt;
    &lt;Extension name=&quot;Y&quot; value=&quot;Y/&quot;/&gt;
    &lt;Extension name=&quot;features&quot; value=&quot;10&quot;/&gt;
    &lt;Extension name=&quot;lambda&quot; value=&quot;0.001&quot;/&gt;
    &lt;Extension name=&quot;implicit&quot; value=&quot;true&quot;/&gt;
    &lt;Extension name=&quot;alpha&quot; value=&quot;1.0&quot;/&gt;
    &lt;Extension name=&quot;XIDs&quot;&gt;56 168 222 343 397 ...
     ...
</pre> 
 </div> 
</div> 
<p>The <tt>X/</tt> and <tt>Y/</tt> subdirectories next to it contain feature vectors, like:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>[56,[0.5746282834154238,-0.08896614131333057,-0.029456222765775263,
  0.6039821219690552,0.1497901814774658,-0.018654312114339863,
  -0.37342063488340266,-0.2370768843521807,1.148260034028485,
  1.0645643656769153]]
[168,[0.8722769882777296,0.4370416943031704,0.27402044461549885,
  -0.031252701117490456,-0.7241385753098256,0.026079081002582338,
  0.42050973702065714,0.27766923396205817,0.6241033215856671,
  -0.48530795198811266]]
...
</pre> 
 </div> 
</div> 
<p>If you are tailing the update topic, you should also see these values published to the topic.</p> 
<p>The Serving Layer will pick this up soon thereafter, and the <tt>/ready</tt> endpoint will return status <tt>200 OK</tt>:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>wget --quiet --output-document - \
  --server-response \
  http://your-serving-layer:8080/ready
...
  HTTP/1.1 200 OK
  Content-Length: 0
  Date: Thu, 18 Dec 2014 13:26:53 GMT
  Server: Oryx
</pre> 
 </div> 
</div> 
<div class="source"> 
 <div class="source"> 
  <pre>wget --quiet --output-document - \
  http://your-serving-layer:8080/recommend/17
...
50,0.7749542842056966
275,0.7373013861581563
258,0.731818692628511
181,0.7049967175706345
127,0.704518989947498
121,0.7014631029793741
15,0.6954683387287907
288,0.6774889711024022
25,0.6663619887033064
285,0.6398968471343595
</pre> 
 </div> 
</div> 
<p>Congratulations, itâ€™s a live recommender!</p> 
<p>When done, all processes can be killed with Ctrl-C safely.</p> 
<p>See more about endpoints that are available in <a href="./API-Endpoint-Reference.html">API-Endpoint-Reference</a>.</p>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2015. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
